The test program for the cgen-0 test:

  void main() {
    static u32 x = 0;
    for (;;) {
      x = x + 1;
    }
  }

  function main:
    static var x : u32, initial val 0
    bb0:
      %5 = const #1
      %10 = ld_static @x
      %15 = add %10, %5
      %20 = st_static %15, @x
      %30 = branch bb0

Expected CHDL output:

  // Function main()
  STATIC_VAR(main, x, ui<32>, 0x00000000);

  // Function main() interfaces
  typedef flit<chdl_void> main_call_t;
  typedef flit<chdl_void> main_ret_t;
  typedef flit<chdl_void> main_bb0_in_t;
  typedef flit<chdl_void> main_bb0_out_t;

  // main() function interfaces
  main_call_t main_call;
  main_ret_t main_ret;

  // main() basic block 0 interfaces
  main_bb0_in_t main_bb0_in;
  vec<1, main_bb0_out_t> main_bb0_out_prebuf, main_bb0_out;

  // main() basic block 0
  vec<2, main_bb0_in_t> main_bb0_arb_in;
  _(main_bb0_arb_in[0], "valid") = _(main_call, "valid");
  _(main_call, "ready") = _(main_bb0_arb_in[0], "ready");

  _(main_bb0_arb_in[1], "valid") = _(main_bb0_out, "valid");
  _(main_call, "ready") = _(main_bb0_arb_in[1], "ready");

  Arbiter(main_bb0_in, ArbRR<2>, main_bb0_arb_in);

  node main_bb0_run(_(main_bb0_in, "valid") &&
    _(main_bb0_out_prebuf[0], "ready"));
  
  ui<32> main_0 = Lit<32>(0x00000001);
  ui<32> main_1 = LD_STATIC(main, x);
  ui<32> main_2 = main_1 + main_0;
  ST_STATIC(main, x, main_2, main_bb0_run);

  _(main_bb0_out_prebuf[0], "valid") = _(main_bb0_in, "valid");
  _(main_bb0_in, "ready") = _(main_bb0_out_prebuf[0], "ready");

  for (unsigned i = 0; i < 1; ++i)
    Buffer<1>(main_bb0_out[i], main_bb0_out_prebuf[i]);
  

  STATIC_VAR_GEN(main, x);

Expected C++ output:


tasks/goals in order of planned completion:

  - Language definition
    - <2016-06-06>
    - Function replication? <2016-06-06>
    - Decide what to do about bit casts.
    - Do we really want a C-style preprocessor?
  - Sample programs
    - h2.1.bpi <2016-06-06>
    - gpu_cache.bpi
    - risc.bpi <2016-06-06>
    - cache.bpi
    - sort.bpi
    - rsort.bpi
    - binsearch.bpi
    - coalesce.bpi
  - Code gen/back end <2016-07-06-23>
    . Build a simple basic block level program for testing.
    . Test some simple structs and a type printing test program.
    . Write code generator that will build simple program. <2016-06-02>
      . Write a "to CHDL" type string converter.
      . Write a "to C++" type string converter.
      . Decide how to identify values (funcname_idx)
      . Write a CHDL runtime with support for static and global variables.
      . Try out the CHDL runtime with some sample code.
    . Build a basic block level program that has control flow and live values.
      <2016.06.08>
      . Get the code written in a cgen-1 example.
      . How do we handle block-to-block communication/generation? SSA/phi?
        - Use phis; the input of a block containing <1> = phi <0>, <11> will
	  contain val_1, not val_0 and val_11. Phi just copies from input.
	- All other external values are also copied from input.
      . Expand CHDL runtime to support block level control flow and live values.
    . Write code generator that will build the with-control-flow program.
      <2016-06-03>
      . Make in/out flits use value id/phi id as name of signal.
      . Write phi generator (just copy from input/output)
      . Make out-of-block arguments use input structure.
      . Write output structure contents assignments/connections.
        x Have to look for phis in destination to use the right name.
	  - Not true. This is done in the wiring up between blocks.
      . Write the runtime support, a buffer and a post-buffer selector.
    . Break the code generator code out into separate headers. <2016-06-03>
    . Separate the headers into .h and .cpp files. <2016-06-03>
    . Build a basic block level program that uses predicated instructions.
      <2016-06-06>
    . Write code generator that will handle predicated instructions.
      <2016-06-06>
    . Build a basic block level program that replaces elements of static arrays.
      (cgen-3) <2016-06-10>
    . Write code generator that will build the element-replacing program.
      <2016-06-10>
      . We need a complete LD_IDX/ST_IDX generator:
        . "index" for single element. "index/length" for multiple.
        . Use constants to read/write to fields of structs. .LD .ST
        . Use pairs of constants to index ranges of elements in arrays. .LD .ST
	. Use single variable to index fixed range of elements in array. .LD .ST
        . Use single const/var to index single elements of arrays. .LD .ST
    . Build a basic block level program that uses struct elements. (cgen-4)
      <2016-06-10>
    . Write code generator that will build the struct-based program.
      <2016-06-10>
    . Build a basic block level program that uses SRAM arrays. <2016-06-13>
    . Add support for SRAM arrays to code generator. <2016-06-13>
    . Write a speical pipeline register for back edges. <2016-06-14>
    . Write a pass to automatically insert back edge annotations. <2016-06-14>
    . Figure out what we're going to do long-term about cycles and ready/stall
      signals. <2016-06-14>
    . Figure out what we're going to do long-term about multi-ported memories.
      <2016-06-14>
    .  Build a basic block level program that makes function calls. <2016-06-15>
    . Add support for function calls to code generator. <2016-06-15>
      . Figure out this ID/live value store SRAM problem.
        - If I store live values in a synchronous SRAM I need the id of the
          function call a cycle before its return value.
      x Add support for blocking call (OP_CALL_BLOCKING)
        - No need.
    . Write an example program that does a loop 10 times then returns.
      . Add and-reduce and or-reduce instructions.
    . Add support for returns to code generator.
      . Add return instruction if it doesn't already exist!
      . Add implementation for return instruction.
        - Should we support multiple returns? No. At least, not yet.
    . Make gen_func() generate a C++/CHDL template function with appropriate
      call/return types.
    . Make passing around of OPAQUE payload part of the live value management
      process (including in the calls to other functions!) <2016-06-21>
    . Make "func" function a part of the cgen-6 test and make sure it works.
      . Oops! We're losing the return value! (fixed)
    . Prune out obviously obsolte or misguided instructions.
      - CALL_BLOCKING is probably unnecessary.
    . Write a basic block level program containing spawns.
    . Add support for spawns to code generator.
    . Build a basic block level program that uses stalls.
      - cgen-9 : src-src-dest based pipeline stalling with random insts.
      - Add support for instant broadcast variables to code generator?
        - Helps stalls, kind-of. Definitely helps forwarding networks.
        - Need both VAL_VALID_BCAST (bit) and VAL_BCAST (original type)
    . Add support for stalls to code generator.
    . Build a basic block level program using concatenate operator.
      - Turns out we need this in cgen-9.
    . Add support for concatenate operator to code generator. <2016-06-22>
    . Do we have to prioririze back edges to avoid deadlocks? Can deadlocks
      happen in looping pipelines? Is just having the double buffer sufficient?
      - It seems like no matter what the priority order, independent threads are
        incapable of deadlocking.
    - Build a basic block level program using (arr/1val) global variables.
    - Add support for global variables to code generator. <2016-06-30>
    - Understand, enumerate, and automatically check (or remove) constraints.
      - Structural constraints:
        - Calls must be the final instruction in a basic block. (limit 1/block)
      - Timing constraints: 
    - Build a basic block level program that uses bypassed SRAM arrays.
    - Add support for bypass networks to code generator. <2016-07-04>
    - Build a basic block level program that uses speculation. <2016-07-04>
    - Add support for speculation to code generator. <2016-07-04>
    - Make TAPs run-time optional.
    - Add support for C++ output to code generator (add separate cgen-cpp)
      <2016-07-04>
    - Make all of the tests self-report success or failure. <2016-07-04>
    - Decide whether functions need to be predicatable. <2016-07-04>
  - C++-based Pipeline Construction Macro Assembler <2016-07-05>
  - Parser/front end <?>
    - Build a skeleton flex/bison parser <?>
    - Get simple static function to parse to AST. <?>
    - Get counter to parse to AST. <?>
    - Get generic function to parse to AST.
    - Get simple AST to convert to IF.
    - Get generic function to parse to AST.
    - Get generic AST to convert to IF.
    - Get h3.bpi working.
    - Get risc.bpi working.
    - Get cache.bpi working.
  - Demo <2016-07-15>
  - Evaluation <2016-07-31>
    -
